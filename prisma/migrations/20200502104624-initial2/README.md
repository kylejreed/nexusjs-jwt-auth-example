# Migration `20200502104624-initial2`

This migration has been generated by kylejreed at 5/2/2020, 10:46:24 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "LikeableEntity" AS ENUM ('Post', 'Comment');

CREATE TABLE "public"."User" (
    "id" SERIAL,
    "username" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Post" (
    "authorId" integer  NOT NULL ,
    "content" text  NOT NULL ,
    "id" SERIAL,
    "title" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Comment" (
    "authorId" integer  NOT NULL ,
    "content" text  NOT NULL ,
    "id" SERIAL,
    "postId" integer  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."LikedContent" (
    "entity" "LikeableEntity" NOT NULL ,
    "entityId" integer  NOT NULL ,
    "userId" integer  NOT NULL ,
    PRIMARY KEY ("userId")
) 

CREATE UNIQUE INDEX "User.username" ON "public"."User"("username")

ALTER TABLE "public"."Post" ADD FOREIGN KEY ("authorId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY ("postId")REFERENCES "public"."Post"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY ("authorId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."LikedContent" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200502103217-initial..20200502104624-initial2
--- datamodel.dml
+++ datamodel.dml
@@ -1,14 +1,50 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 generator prisma_client {
   provider = "prisma-client-js"
 }
-     
+
 model World {
-  id         Int    @id @default(autoincrement())
+  id         Int    @default(autoincrement()) @id
   name       String @unique
   population Float
+}
+
+model User {
+  id       Int    @default(autoincrement()) @id
+  username String @unique
+  posts    Post[]
+}
+
+model Post {
+  id       Int       @default(autoincrement()) @id
+  title    String
+  content  String
+  author   User      @relation(fields: [authorId], references: [id])
+  authorId Int
+  comments Comment[]
+}
+
+model Comment {
+  id       Int    @default(autoincrement()) @id
+  content  String
+  post     Post   @relation(fields: [postId], references: [id])
+  postId   Int
+  author   User   @relation(fields: [authorId], references: [id])
+  authorId Int
+}
+
+enum LikeableEntity {
+  Post
+  Comment
+}
+
+model LikedContent {
+  user     User           @relation(fields: [userId], references: [id])
+  userId   Int            @id
+  entity   LikeableEntity
+  entityId Int
 }
```


